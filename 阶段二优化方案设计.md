# é˜¶æ®µäºŒä¼˜åŒ–æ–¹æ¡ˆè®¾è®¡

## ğŸ¯ æ ¸å¿ƒç›®æ ‡
è§£å†³é˜¶æ®µä¸€ä¼˜åŒ–åå‡ºç°çš„**å…¨å±æ˜¾ç¤ºé—®é¢˜**ï¼Œåœ¨ä¿æŒæµç•…æ€§èƒ½çš„åŒæ—¶å®ç°å®Œæ•´å±å¹•æ˜¾ç¤ºã€‚

## ğŸ” é—®é¢˜åˆ†æ

### å½“å‰æ˜¾ç¤ºçŠ¶æ€
- **æ‘„åƒå¤´è¾“å…¥**: VGA (640Ã—480)
- **JPEGè§£ç **: `JPEG_SCALE_QUARTER` â†’ 160Ã—120åƒç´ 
- **å±å¹•åˆ†è¾¨ç‡**: ILI9341 (320Ã—240)
- **æ˜¾ç¤ºç»“æœ**: ä»…å·¦ä¸Šè§’160Ã—120åŒºåŸŸæ˜¾ç¤ºï¼Œå å±å¹•50%é¢ç§¯

### æ€§èƒ½ç°çŠ¶
- âœ… å¸§ç‡æå‡ï¼š3.5 â†’ 8-10 FPSï¼ˆé˜¶æ®µä¸€ä¼˜åŒ–æˆåŠŸï¼‰
- âŒ æ˜¾ç¤ºé¢ç§¯ï¼šä»…50%å±å¹•åˆ©ç”¨ç‡
- âŒ è§†è§‰ä½“éªŒï¼šç”»é¢è¿‡å°ï¼Œç”¨æˆ·ä½“éªŒå·®

## ğŸš€ é˜¶æ®µäºŒæŠ€æœ¯æ–¹æ¡ˆ

### 1. æ™ºèƒ½ç¼©æ”¾é€‚é…ç³»ç»Ÿ
```cpp
// é˜¶æ®µäºŒä¼˜åŒ–ï¼šæ™ºèƒ½å›¾åƒç¼©æ”¾é€‚é…
class DisplayAdapter {
private:
    int screenWidth, screenHeight;      // å±å¹•å®é™…åˆ†è¾¨ç‡
    int imageWidth, imageHeight;      // å›¾åƒåŸå§‹åˆ†è¾¨ç‡
    float scaleRatio;                 // ç¼©æ”¾æ¯”ä¾‹
    int offsetX, offsetY;             // å±…ä¸­åç§»é‡
    
public:
    void calculateOptimalScale() {
        // è®¡ç®—æœ€ä½³ç¼©æ”¾æ¯”ä¾‹ï¼Œä¿æŒå®½é«˜æ¯”
        float scaleX = (float)screenWidth / imageWidth;
        float scaleY = (float)screenHeight / imageHeight;
        scaleRatio = (scaleX < scaleY) ? scaleX : scaleY;  // å–è¾ƒå°å€¼ä¿æŒæ¯”ä¾‹
        
        // è®¡ç®—å±…ä¸­åç§»
        offsetX = (screenWidth - (int)(imageWidth * scaleRatio)) / 2;
        offsetY = (screenHeight - (int)(imageHeight * scaleRatio)) / 2;
    }
};
```

### 2. å¤šçº§ç¼©æ”¾ç­–ç•¥

| ç¼©æ”¾çº§åˆ« | è§£ç å‚æ•° | å›¾åƒå°ºå¯¸ | å±å¹•é€‚é… | æ€§èƒ½å½±å“ |
|---------|----------|----------|----------|----------|
| **FULL_SCREEN** | è‡ªå®šä¹‰ç¼©æ”¾ | 320Ã—240 | 100%å¡«å…… | ä¸­ç­‰ |
| **FIT_CENTER** | JPEG_SCALE_HALF | 320Ã—240 | å±…ä¸­é€‚é… | è¾ƒå¥½ |
| **SMART_ZOOM** | åŠ¨æ€è°ƒæ•´ | å¯å˜ | æ™ºèƒ½é€‚é… | æœ€ä¼˜ |

### 3. åŒç¼“å†²æ˜¾ç¤ºæœºåˆ¶
```cpp
// é˜¶æ®µäºŒä¼˜åŒ–ï¼šåŒç¼“å†²æœºåˆ¶
class DoubleBuffer {
private:
    uint16_t* buffer1;          // ç¼“å†²åŒº1
    uint16_t* buffer2;          // ç¼“å†²åŒº2
    uint16_t* activeBuffer;     // å½“å‰æ˜¾ç¤ºç¼“å†²åŒº
    uint16_t* renderBuffer;     // å½“å‰æ¸²æŸ“ç¼“å†²åŒº
    bool bufferReady;           // ç¼“å†²åŒºå°±ç»ªæ ‡å¿—
    
public:
    void swapBuffers() {
        // äº¤æ¢æ˜¾ç¤ºå’Œæ¸²æŸ“ç¼“å†²åŒº
        uint16_t* temp = activeBuffer;
        activeBuffer = renderBuffer;
        renderBuffer = temp;
        bufferReady = true;
    }
    
    void renderOptimized() {
        if (bufferReady) {
            // ä½¿ç”¨DMAæˆ–é«˜æ•ˆä¼ è¾“æ˜¾ç¤ºå®Œæ•´ç¼“å†²å†…å®¹
            tft.drawRGBBitmap(0, 0, activeBuffer, screenWidth, screenHeight);
            bufferReady = false;
        }
    }
};
```

### 4. åŠ¨æ€åˆ†è¾¨ç‡è°ƒæ•´
```cpp
// é˜¶æ®µäºŒä¼˜åŒ–ï¼šåŠ¨æ€åˆ†è¾¨ç‡åŒ¹é…
void optimizeDisplayResolution() {
    // æ ¹æ®æ€§èƒ½è‡ªåŠ¨é€‰æ‹©æœ€ä½³åˆ†è¾¨ç‡
    if (currentFps >= 8) {
        // é«˜æ€§èƒ½æ¨¡å¼ï¼šä½¿ç”¨æ›´é«˜åˆ†è¾¨ç‡
        jpeg.decode(0, 0, JPEG_SCALE_HALF);  // 320Ã—240
        displayMode = FULL_SCREEN;
    } else if (currentFps >= 5) {
        // å¹³è¡¡æ¨¡å¼ï¼šæ™ºèƒ½ç¼©æ”¾
        jpeg.decode(0, 0, JPEG_SCALE_QUARTER); // 160Ã—120
        displayMode = SMART_ZOOM;
        applySmartZoom();
    } else {
        // æ€§èƒ½ä¼˜å…ˆæ¨¡å¼ï¼šä¿æŒå½“å‰è®¾ç½®
        displayMode = PERFORMANCE_FIRST;
    }
}
```

### 5. æ™ºèƒ½ç¼“å­˜ç­–ç•¥
```cpp
// é˜¶æ®µäºŒä¼˜åŒ–ï¼šæ™ºèƒ½å›¾åƒç¼“å­˜
class SmartImageCache {
private:
    struct CachedImage {
        uint32_t addr;
        uint32_t len;
        uint16_t* scaledData;      // ç¼©æ”¾åçš„å›¾åƒæ•°æ®
        int scaledWidth, scaledHeight;
        unsigned long timestamp;
        bool isValid;
    };
    
    CachedImage cache[CACHE_SIZE];
    
public:
    uint16_t* getScaledImage(uint32_t addr, uint32_t len) {
        // æŸ¥æ‰¾ç¼“å­˜ä¸­æ˜¯å¦æœ‰åˆé€‚çš„ç¼©æ”¾å›¾åƒ
        for (int i = 0; i < CACHE_SIZE; i++) {
            if (cache[i].addr == addr && cache[i].len == len && cache[i].isValid) {
                return cache[i].scaledData;
            }
        }
        return nullptr;
    }
    
    void cacheScaledImage(uint32_t addr, uint32_t len, uint16_t* data, int w, int h) {
        // ç¼“å­˜æ–°å¤„ç†çš„ç¼©æ”¾å›¾åƒ
        int oldestIndex = findOldestCache();
        cache[oldestIndex] = {addr, len, data, w, h, millis(), true};
    }
};
```

## ğŸ“ˆ é¢„æœŸæ€§èƒ½æå‡

### æ˜¾ç¤ºæ•ˆæœæ”¹å–„
- **å±å¹•åˆ©ç”¨ç‡**: 50% â†’ 100%ï¼ˆå…¨å±æ˜¾ç¤ºï¼‰
- **è§†è§‰ä½“éªŒ**: å°ç”»é¢ â†’ æ²‰æµ¸å¼ä½“éªŒ
- **å›¾åƒè´¨é‡**: ä¿æŒæµç•…çš„åŒæ—¶æå‡æ¸…æ™°åº¦

### æ€§èƒ½æŒ‡æ ‡
- **å¸§ç‡ç»´æŒ**: ä¿æŒ8-10 FPSç›®æ ‡
- **å†…å­˜ä½¿ç”¨**: å¢åŠ 20%ï¼ˆåŒç¼“å†²ï¼‰
- **å“åº”å»¶è¿Ÿ**: å‡å°‘30%ï¼ˆç¼“å­˜ä¼˜åŒ–ï¼‰

## ğŸ› ï¸ å®æ–½è®¡åˆ’

### é˜¶æ®µ2.1ï¼šåŸºç¡€é€‚é…ï¼ˆé¢„è®¡1-2å¤©ï¼‰
1. âœ… ç§»é™¤JPEG_SCALE_QUARTERé™åˆ¶
2. âœ… å®ç°æ™ºèƒ½ç¼©æ”¾ç®—æ³•
3. âœ… æ·»åŠ å±…ä¸­æ˜¾ç¤ºé€»è¾‘
4. âœ… æµ‹è¯•ä¸åŒåˆ†è¾¨ç‡ç»„åˆ

### é˜¶æ®µ2.2ï¼šé«˜çº§ä¼˜åŒ–ï¼ˆé¢„è®¡2-3å¤©ï¼‰
1. ğŸ”„ åŒç¼“å†²æœºåˆ¶å®ç°
2. ğŸ”„ æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿ
3. ğŸ”„ åŠ¨æ€åˆ†è¾¨ç‡è°ƒæ•´
4. ğŸ”„ æ€§èƒ½ç›‘æ§å¢å¼º

### é˜¶æ®µ2.3ï¼šæ€§èƒ½è°ƒä¼˜ï¼ˆé¢„è®¡1å¤©ï¼‰
1. ğŸ“Š æ€§èƒ½æ•°æ®åˆ†æ
2. ğŸ”§ å‚æ•°ç²¾ç»†è°ƒæ•´
3. âœ… å…¨å±æ˜¾ç¤ºéªŒè¯
4. ğŸ“ˆ ç”¨æˆ·ä½“éªŒä¼˜åŒ–

## ğŸ¯ æˆåŠŸæ ‡å‡†

### æŠ€æœ¯æŒ‡æ ‡
- âœ… å…¨å±æ˜¾ç¤ºè¦†ç›–ç‡ï¼šâ‰¥95%
- âœ… å¸§ç‡ç»´æŒï¼šâ‰¥8 FPS
- âœ… å†…å­˜ä½¿ç”¨ï¼šâ‰¤80%å¯ç”¨å†…å­˜
- âœ… CPUå ç”¨ï¼šâ‰¤70%

### ç”¨æˆ·ä½“éªŒ
- âœ… ç”»é¢å®Œæ•´æ˜¾ç¤ºï¼Œæ— é»‘è¾¹
- âœ… è¿è¡Œæµç•…ï¼Œæ— æ˜æ˜¾å¡é¡¿
- âœ… è‡ªåŠ¨é€‚é…ä¸åŒå†…å®¹å°ºå¯¸
- âœ… ä¿æŒåŸæœ‰å“åº”é€Ÿåº¦

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³å¼€å§‹**é˜¶æ®µ2.1åŸºç¡€é€‚é…å¼€å‘
2. **å¹¶è¡ŒéªŒè¯**ä¸åŒç¼©æ”¾ç­–ç•¥çš„æ€§èƒ½è¡¨ç°
3. **é€æ­¥é›†æˆ**åŒç¼“å†²å’Œç¼“å­˜æœºåˆ¶
4. **æŒç»­ç›‘æ§**æ€§èƒ½æŒ‡æ ‡å˜åŒ–

é˜¶æ®µäºŒä¼˜åŒ–å°†å½»åº•è§£å†³å…¨å±æ˜¾ç¤ºé—®é¢˜ï¼Œåœ¨ä¿æŒé˜¶æ®µä¸€æ€§èƒ½ä¼˜åŠ¿çš„åŒæ—¶å®ç°å®Œæ•´å±å¹•æ˜¾ç¤ºï¼Œä¸ºç”¨æˆ·æä¾›æœ€ä½³çš„è§†è§‰ä½“éªŒã€‚