# æ¨¡å—åŒ–è¯¦ç»†åŠŸèƒ½è¯´æ˜

## ğŸ“ **Camera.ino - ä¸»ç¨‹åº**
**åŠŸèƒ½**: ç³»ç»Ÿå…¥å£ï¼Œä»…è´Ÿè´£åˆå§‹åŒ–å’Œå¯åŠ¨FreeRTOSè°ƒåº¦å™¨
**åŒ…å«**:
- `setup()`: ç³»ç»Ÿåˆå§‹åŒ–å…¥å£ï¼Œè°ƒç”¨å„æ¨¡å—åˆå§‹åŒ–å‡½æ•°
- `loop()`: FreeRTOSæ¥ç®¡åï¼Œè¿™é‡Œå¯ç©ºæˆ–å¤„ç†ä½ä¼˜å…ˆçº§ä»»åŠ¡
**è®¾è®¡åŸåˆ™**:
- ä¿æŒæç®€ï¼Œä¸åŒ…å«ä»»ä½•ä¸šåŠ¡é€»è¾‘
- ä»…è´Ÿè´£æ¨¡å—ä¹‹é—´çš„è¿æ¥å’Œåè°ƒ

---

## ğŸ”„ **Encoder/ - ç¼–ç å™¨æ¨¡å—**

### **examples/Camera/Encoder_Control.h/.cpp**
**åŠŸèƒ½**: EC11æ—‹è½¬ç¼–ç å™¨çš„å®Œæ•´é©±åŠ¨ç¨‹åº
**æ ¸å¿ƒèŒè´£**:
1. å¼•è„šé…ç½®ä¸åˆå§‹åŒ–
2. æ—‹è½¬æ–¹å‘æ£€æµ‹ç®—æ³•
3. æŒ‰é’®æ¶ˆæŠ–å¤„ç†
4. æä¾›äº‹ä»¶å›è°ƒæ¥å£
5. ç¼–ç å™¨çŠ¶æ€ç®¡ç†

**ä¸»è¦æ¥å£**:
```cpp
class EncoderControl {
public:
    typedef enum {
        ROTATION_NONE = 0,
        ROTATION_CW = 1,      // é¡ºæ—¶é’ˆ
        ROTATION_CCW = -1     // é€†æ—¶é’ˆ
    } RotationDirection;
    
    typedef std::function<void(RotationDirection)> RotationCallback;
    typedef std::function<void()> ButtonCallback;
    
    // åˆå§‹åŒ–
    bool init(uint8_t clkPin, uint8_t dtPin, uint8_t swPin);
    
    // äº‹ä»¶æ³¨å†Œ
    void setRotationCallback(RotationCallback cb);
    void setButtonCallback(ButtonCallback cb);
    
    // çŠ¶æ€æŸ¥è¯¢
    RotationDirection getLastRotation();
    bool isButtonPressed();
    
    // æ¶ˆæŠ–å‚æ•°é…ç½®
    void setDebounceTime(unsigned long ms);
    
    // æ¸…ç†èµ„æº
    void cleanup();
};
```

### **EncoderInterrupt.h** (å¯é€‰)
**åŠŸèƒ½**: ç¼–ç å™¨ä¸­æ–­æœåŠ¡ä¾‹ç¨‹
**è®¾è®¡é€‰æ‹©**:
- å¯ä½œä¸º`EncoderControl`çš„å†…éƒ¨é™æ€å‡½æ•°
- æˆ–å•ç‹¬æ–‡ä»¶ä»¥ä¿æŒä»£ç æ¸…æ™°
**å…³é”®å‡½æ•°**:
```cpp
// ä¸­æ–­å¤„ç†å‡½æ•°åŸå‹
static void encoderISR(uint32_t id, uint32_t event);
```

---

## ğŸ–¥ï¸ **Display/ - æ˜¾ç¤ºæ¨¡å—**

### **examples/Camera/Display_TFTManager.h/.cpp**
**åŠŸèƒ½**: SPI1å’ŒDMAæ˜¾ç¤ºæ ¸å¿ƒé©±åŠ¨
**æ ¸å¿ƒèŒè´£**:
1. TFTå±å¹•åˆå§‹åŒ–ä¸é…ç½®
2. SPIå’ŒDMAé€šé“ç®¡ç†
3. å±å¹•ç¼“å†²åŒºç®¡ç†
4. æ˜¾ç¤ºæ¨¡å¼åˆ‡æ¢
5. èƒŒå…‰æ§åˆ¶

**ä¸»è¦æ¥å£**:
```cpp
class TFTManager {
public:
    typedef enum {
        MODE_NORMAL = 0,
        MODE_LOW_POWER = 1,
        MODE_HIGH_PERF = 2
    } DisplayMode;
    
    // åˆå§‹åŒ–
    bool init(uint8_t csPin, uint8_t dcPin, uint8_t rstPin, uint8_t blPin);
    
    // åŸºæœ¬æ˜¾ç¤ºæ“ä½œ
    void fillScreen(uint16_t color);
    void setPixel(uint16_t x, uint16_t y, uint16_t color);
    void drawLine(uint16_t x0, uint16_t y0, uint16_t x1, uint16_t y1, uint16_t color);
    void drawRectangle(uint16_t x, uint16_t y, uint16_t w, uint16_t h, uint16_t color);
    void fillRectangle(uint16_t x, uint16_t y, uint16_t w, uint16_t h, uint16_t color);
    
    // ä½å›¾æ“ä½œï¼ˆDMAåŠ é€Ÿï¼‰
    void drawBitmap(uint16_t x, uint16_t y, uint16_t w, uint16_t h, const uint16_t* bitmap);
    void drawBitmapDMA(uint16_t x, uint16_t y, uint16_t w, uint16_t h, const uint16_t* bitmap);
    
    // æ˜¾ç¤ºæ§åˆ¶
    void setBrightness(uint8_t level);  // 0-255
    void setRotation(uint8_t rotation); // 0-3
    void setDisplayMode(DisplayMode mode);
    
    // ç¼“å†²åŒºç®¡ç†
    uint16_t* getFrameBuffer();
    void swapBuffers();  // åŒç¼“å†²äº¤æ¢
    void flushBuffer();  // å¼ºåˆ¶åˆ·æ–°åˆ°å±å¹•
    
    // æ¸…ç†
    void cleanup();
};
```

### **examples/Camera/Display_FontRenderer.h/.cpp**
**åŠŸèƒ½**: 16x16ç‚¹é˜µå­—åº“æ¸²æŸ“å¼•æ“
**æ ¸å¿ƒèŒè´£**:
1. å­—ä½“æ•°æ®ç®¡ç†
2. å­—ç¬¦å’Œå­—ç¬¦ä¸²æ¸²æŸ“
3. å­—ä½“é¢œè‰²å’ŒèƒŒæ™¯è‰²æ§åˆ¶
4. å­—ç¬¦æ—‹è½¬å¤„ç†
5. å­—ä½“ç¼“å­˜ä¼˜åŒ–

**ä¸»è¦æ¥å£**:
```cpp
class FontRenderer {
public:
    // åˆå§‹åŒ–ï¼ˆä¼ å…¥16x16å­—åº“æ•°æ®ï¼‰
    bool init(const uint8_t* fontData[], size_t fontCount);
    
    // å•ä¸ªå­—ç¬¦æ¸²æŸ“
    bool drawChar(uint16_t x, uint16_t y, uint8_t charIndex, 
                  uint16_t color = 0xFFFF, uint16_t bgColor = 0x0000,
                  bool rotate90 = true);
    
    // å­—ç¬¦ä¸²æ¸²æŸ“ï¼ˆæ”¯æŒä¸­è‹±æ–‡æ··åˆï¼‰
    bool drawString(uint16_t x, uint16_t y, const char* str,
                    uint16_t color = 0xFFFF, uint16_t bgColor = 0x0000,
                    uint8_t spacing = 1);
    
    // ä¸­æ–‡å­—ç¬¦ä¸²æ¸²æŸ“ï¼ˆä½¿ç”¨é¢„å®šä¹‰å­—ç¬¦ç´¢å¼•ï¼‰
    bool drawChineseString(uint16_t x, uint16_t y, const uint8_t* charIndices,
                           uint16_t color = 0xFFFF, uint16_t bgColor = 0x0000);
    
    // å­—ä½“å¤§å°æŸ¥è¯¢
    uint8_t getCharWidth() const;   // å­—ç¬¦å®½åº¦ï¼ˆåƒç´ ï¼‰
    uint8_t getCharHeight() const;  // å­—ç¬¦é«˜åº¦ï¼ˆåƒç´ ï¼‰
    
    // å­—ç¬¦ä¸²å°ºå¯¸è®¡ç®—
    uint16_t calculateStringWidth(const char* str) const;
    uint16_t calculateChineseStringWidth(const uint8_t* charIndices) const;
    
    // é«˜çº§åŠŸèƒ½ï¼šå­—ç¬¦ç¼“å­˜
    void enableCache(bool enable);
    void clearCache();
};
```

### **examples/Camera/Display_GraphicsPrimitives.h/.cpp**
**åŠŸèƒ½**: åŸºæœ¬å›¾å½¢ç»˜åˆ¶ï¼ˆä¸‰è§’å½¢ã€åœ†å½¢ç­‰ï¼‰
**æ ¸å¿ƒèŒè´£**:
1. ä¸‰è§’å½¢ç»˜åˆ¶å’Œæ¸…é™¤
2. å…¶ä»–åŸºæœ¬å›¾å½¢ç»˜åˆ¶
3. å›¾å½¢å˜æ¢ï¼ˆç§»åŠ¨ã€æ—‹è½¬ï¼‰
4. å›¾å½¢ç¢°æ’æ£€æµ‹

**ä¸»è¦æ¥å£**:
```cpp
class GraphicsPrimitives {
public:
    // ä¸‰è§’å½¢ç»“æ„ä½“
    struct Triangle {
        uint16_t x1, y1;  // é¡¶ç‚¹1
        uint16_t x2, y2;  // é¡¶ç‚¹2
        uint16_t x3, y3;  // é¡¶ç‚¹3
    };
    
    // ä¸‰è§’å½¢æ“ä½œ
    Triangle createTriangle(uint16_t centerX, uint16_t centerY, uint16_t size);
    void drawTriangle(const Triangle& tri, uint16_t color);
    void fillTriangle(const Triangle& tri, uint16_t color);
    void clearTriangle(const Triangle& tri, uint16_t bgColor);
    
    // èœå•ä¸‰è§’å½¢ä¸“ç”¨å‡½æ•°
    Triangle createMenuTriangle(uint8_t position);  // A-Fä½ç½®
    void drawMenuTriangle(uint8_t position, uint16_t color);
    void clearMenuTriangle(uint8_t position);
    
    // å…¶ä»–å›¾å½¢
    void drawCircle(uint16_t x, uint16_t y, uint16_t r, uint16_t color);
    void fillCircle(uint16_t x, uint16_t y, uint16_t r, uint16_t color);
    
    // å›¾å½¢è¾…åŠ©å‡½æ•°
    bool isPointInTriangle(uint16_t x, uint16_t y, const Triangle& tri);
};
```

---

## ğŸ“‹ **Menu/ - èœå•æ¨¡å—**

### **examples/Camera/Menu_MenuManager.h/.cpp**
**åŠŸèƒ½**: èœå•ç³»ç»Ÿæ ¸å¿ƒç®¡ç†
**æ ¸å¿ƒèŒè´£**:
1. å¤šçº§èœå•ç®¡ç†ï¼ˆä¸»èœå•ã€å­èœå•ï¼‰
2. èœå•é¡µé¢åˆ‡æ¢
3. èœå•é¡¹é€‰æ‹©å’Œç¡®è®¤
4. èœå•çŠ¶æ€æŒä¹…åŒ–
5. èœå•äº‹ä»¶å¤„ç†

**ä¸»è¦æ¥å£**:
```cpp
class MenuManager {
public:
    typedef enum {
        STATE_MAIN_MENU = 0,
        STATE_SUB_MENU = 1,
        STATE_CAMERA_PREVIEW = 2,
        STATE_SETTINGS = 3
    } MenuState;
    
    // åˆå§‹åŒ–ï¼ˆä¼ å…¥TFTManagerå¼•ç”¨ï¼‰
    bool init(TFTManager& display);
    
    // èœå•é¡µé¢ç®¡ç†
    void addPage(const uint8_t* imageData, uint32_t imageSize, 
                 uint16_t width, uint16_t height);
    bool switchToPage(uint8_t pageIndex);
    void showCurrentPage();
    uint8_t getCurrentPageIndex() const;
    
    // èœå•çŠ¶æ€ç®¡ç†
    MenuState getCurrentState() const;
    void setState(MenuState newState);
    
    // äº‹ä»¶å¤„ç†
    void handleRotation(int direction);  // ç¼–ç å™¨æ—‹è½¬
    void handleButtonPress();            // æŒ‰é’®æŒ‰ä¸‹
    void handleExitRequest();            // é€€å‡ºè¯·æ±‚
    
    // èœå•é¡¹æ“ä½œ
    bool selectMenuItem(uint8_t itemIndex);
    bool activateMenuItem(uint8_t itemIndex);
    
    // æ¸…ç†
    void cleanup();
};
```

### **examples/Camera/Menu_TriangleController.h/.cpp**
**åŠŸèƒ½**: èœå•ä¸‰è§’å½¢æ§åˆ¶å™¨
**æ ¸å¿ƒèŒè´£**:
1. ä¸‰è§’å½¢ä½ç½®ç²¾ç¡®æ§åˆ¶
2. ä¸‰è§’å½¢åŠ¨ç”»æ•ˆæœ
3. ä¸‰è§’å½¢ä½ç½®è®°å¿†
4. ä¸èœå•é¡¹è”åŠ¨

**ä¸»è¦æ¥å£**:
```cpp
class TriangleController {
public:
    typedef enum {
        POSITION_A = 0,
        POSITION_B = 1,
        POSITION_C = 2,
        POSITION_D = 3,
        POSITION_E = 4,
        POSITION_F = 5
    } MenuPosition;
    
    // åˆå§‹åŒ–ï¼ˆä¼ å…¥GraphicsPrimitiveså¼•ç”¨ï¼‰
    bool init(GraphicsPrimitives& graphics);
    
    // ä¸‰è§’å½¢ç§»åŠ¨æ§åˆ¶
    void moveToPosition(MenuPosition position);
    void moveUp();
    void moveDown();
    
    // å½“å‰ä½ç½®ç®¡ç†
    MenuPosition getCurrentPosition() const;
    void setCurrentPosition(MenuPosition position);
    
    // æ˜¾ç¤ºæ§åˆ¶
    void show();
    void hide();
    void update();
    
    // åŠ¨ç”»æ•ˆæœ
    void enableAnimation(bool enable);
    void setAnimationSpeed(uint16_t ms);
    
    // åæ ‡è®¡ç®—
    uint16_t getPositionX(MenuPosition position) const;
    uint16_t getPositionY(MenuPosition position) const;
    
    // æ¸…ç†
    void cleanup();
};
```

### **examples/Camera/MenuPages.h**
**åŠŸèƒ½**: èœå•é¡µé¢æ•°æ®å®šä¹‰
**åŒ…å«**:
1. ä¸»èœå•ä½å›¾æ•°æ®
2. å­èœå•ä½å›¾æ•°æ®
3. èœå•é¡¹å®šä¹‰
4. èœå•å¸ƒå±€å¸¸é‡

**å†…å®¹ç¤ºä¾‹**:
```cpp
// èœå•é¡µé¢æšä¸¾
enum MenuPage {
    PAGE_MAIN_MENU = 0,
    PAGE_SUB_MENU = 1,
    PAGE_CAMERA_SETTINGS = 2,
    PAGE_SYSTEM_SETTINGS = 3
};

// ä¸»èœå•æ•°æ®
extern const uint8_t MM_IMAGE_DATA[];
extern const uint32_t MM_IMAGE_SIZE;
extern const uint16_t MM_IMAGE_WIDTH;
extern const uint16_t MM_IMAGE_HEIGHT;

// å­èœå•æ•°æ®
extern const uint8_t SM_IMAGE_DATA[];
extern const uint32_t SM_IMAGE_SIZE;
extern const uint16_t SM_IMAGE_WIDTH;
extern const uint16_t SM_IMAGE_HEIGHT;

// èœå•é¡¹å®šä¹‰
struct MenuItem {
    const char* label;
    uint8_t pageIndex;
    void (*action)();
};
```

---

## ğŸ“· **Camera/ - ç›¸æœºæ¨¡å—**

### **examples/Camera/Camera_CameraCore.h/.cpp**
**åŠŸèƒ½**: ç›¸æœºç¡¬ä»¶é©±åŠ¨æ ¸å¿ƒ
**æ ¸å¿ƒèŒè´£**:
1. ç›¸æœºç¡¬ä»¶åˆå§‹åŒ–
2. è§†é¢‘é€šé“é…ç½®
3. ç›¸æœºå‚æ•°æ§åˆ¶
4. ç›¸æœºçŠ¶æ€ç®¡ç†
5. é”™è¯¯å¤„ç†

**ä¸»è¦æ¥å£**:
```cpp
class CameraCore {
public:
    typedef enum {
        CHANNEL_PREVIEW = 0,  // é¢„è§ˆé€šé“
        CHANNEL_STILL = 1,     // æ‹ç…§é€šé“
        CHANNEL_MAX
    } VideoChannel;
    
    typedef struct {
        uint32_t resolution;   // VIDEO_VGA, VIDEO_HDç­‰
        uint32_t fps;
        uint32_t format;       // VIDEO_JPEGç­‰
        uint32_t bitrate;
    } VideoConfig;
    
    // åˆå§‹åŒ–
    bool init();
    
    // é€šé“ç®¡ç†
    bool configChannel(VideoChannel ch, const VideoConfig& config);
    bool startChannel(VideoChannel ch);
    bool stopChannel(VideoChannel ch);
    bool isChannelActive(VideoChannel ch) const;
    
    // å›¾åƒæ•è·
    bool captureImage(VideoChannel ch, uint32_t* imgAddr, uint32_t* imgLen);
    
    // ç›¸æœºå‚æ•°æ§åˆ¶
    bool setExposure(int32_t value);
    bool setWhiteBalance(int32_t value);
    bool setFocus(int32_t value);
    
    // çŠ¶æ€æŸ¥è¯¢
    bool isInitialized() const;
    const char* getLastError() const;
    
    // æ¸…ç†
    void cleanup();
};
```

### **examples/Camera/Camera_PreviewManager.h/.cpp**
**åŠŸèƒ½**: å®æ—¶é¢„è§ˆç®¡ç†å™¨
**æ ¸å¿ƒèŒè´£**:
1. é¢„è§ˆæµæ§åˆ¶
2. å¸§ç‡ç®¡ç†
3. é¢„è§ˆç”»é¢å¤„ç†
4. é¢„è§ˆçŠ¶æ€ç®¡ç†

**ä¸»è¦æ¥å£**:
```cpp
class PreviewManager {
public:
    typedef enum {
        PREVIEW_MODE_NORMAL = 0,
        PREVIEW_MODE_FULLSCREEN = 1,
        PREVIEW_MODE_PIP = 2      // ç”»ä¸­ç”»
    } PreviewMode;
    
    // åˆå§‹åŒ–ï¼ˆä¼ å…¥CameraCoreå’ŒTFTManagerå¼•ç”¨ï¼‰
    bool init(CameraCore& camera, TFTManager& display);
    
    // é¢„è§ˆæ§åˆ¶
    bool startPreview();
    bool stopPreview();
    bool pausePreview();
    bool resumePreview();
    
    // é¢„è§ˆè®¾ç½®
    void setPreviewMode(PreviewMode mode);
    void setFrameRate(uint8_t fps);
    void setDisplayArea(uint16_t x, uint16_t y, uint16_t w, uint16_t h);
    
    // é¢„è§ˆå¤„ç†
    void processPreviewFrame();
    
    // çŠ¶æ€æŸ¥è¯¢
    bool isPreviewActive() const;
    uint8_t getCurrentFrameRate() const;
    
    // æ€§èƒ½ç»Ÿè®¡
    void getStatistics(uint32_t* totalFrames, uint32_t* droppedFrames);
    
    // æ¸…ç†
    void cleanup();
};
```

### **examples/Camera/Camera_PhotoCapture.h/.cpp**
**åŠŸèƒ½**: æ‹ç…§å’Œä¿å­˜ç®¡ç†å™¨
**æ ¸å¿ƒèŒè´£**:
1. æ‹ç…§è§¦å‘æ§åˆ¶
2. å›¾åƒè´¨é‡è®¾ç½®
3. ç…§ç‰‡ä¿å­˜ç®¡ç†
4. æ‹ç…§çŠ¶æ€åé¦ˆ

**ä¸»è¦æ¥å£**:
```cpp
class PhotoCapture {
public:
    typedef enum {
        CAPTURE_MODE_SINGLE = 0,
        CAPTURE_MODE_BURST = 1,
        CAPTURE_MODE_TIMER = 2
    } CaptureMode;
    
    typedef struct {
        uint16_t width;
        uint16_t height;
        uint8_t quality;      // JPEGè´¨é‡ 1-100
        CaptureMode mode;
        uint8_t burstCount;   // è¿æ‹æ•°é‡
        uint16_t timerDelay;  // å®šæ—¶å™¨å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
    } CaptureConfig;
    
    // åˆå§‹åŒ–
    bool init(CameraCore& camera, SDCardManager& sdCard);
    
    // æ‹ç…§æ§åˆ¶
    bool captureSingle();
    bool startBurstCapture(uint8_t count);
    bool startTimerCapture(uint16_t delayMs);
    bool cancelCapture();
    
    // é…ç½®ç®¡ç†
    void setConfig(const CaptureConfig& config);
    const CaptureConfig& getConfig() const;
    
    // çŠ¶æ€æŸ¥è¯¢
    bool isCapturing() const;
    uint8_t getRemainingBurstCount() const;
    
    // ç…§ç‰‡ä¿¡æ¯
    uint32_t getLastPhotoSize() const;
    const char* getLastPhotoPath() const;
    
    // æ¸…ç†
    void cleanup();
};
```

### **examples/Camera/Camera_SDCardManager.h/.cpp**
**åŠŸèƒ½**: SDå¡æ–‡ä»¶ç³»ç»Ÿç®¡ç†
**æ ¸å¿ƒèŒè´£**:
1. SDå¡åˆå§‹åŒ–
2. æ–‡ä»¶è¯»å†™æ“ä½œ
3. æ–‡ä»¶ç³»ç»Ÿç®¡ç†
4. å­˜å‚¨ç©ºé—´ç›‘æ§

**ä¸»è¦æ¥å£**:
```cpp
class SDCardManager {
public:
    typedef struct {
        uint64_t totalBytes;
        uint64_t freeBytes;
        uint64_t usedBytes;
        uint8_t percentUsed;
    } StorageInfo;
    
    // åˆå§‹åŒ–
    bool init();
    
    // æ–‡ä»¶æ“ä½œ
    bool fileExists(const char* path);
    bool createFile(const char* path);
    bool deleteFile(const char* path);
    bool renameFile(const char* oldPath, const char* newPath);
    
    // æ•°æ®è¯»å†™
    int32_t writeFile(const char* path, const uint8_t* data, uint32_t size);
    int32_t readFile(const char* path, uint8_t* buffer, uint32_t bufferSize);
    
    // ç›®å½•æ“ä½œ
    bool createDirectory(const char* path);
    bool listDirectory(const char* path, char* buffer, uint32_t bufferSize);
    
    // å­˜å‚¨ä¿¡æ¯
    bool getStorageInfo(StorageInfo* info);
    const char* getRootPath() const;
    
    // æ–‡ä»¶å‘½å
    char* generatePhotoFileName(char* buffer, uint32_t bufferSize);
    char* generateTimestampFileName(char* buffer, uint32_t bufferSize, const char* extension);
    
    // æ¸…ç†
    void cleanup();
};
```

---

## âš™ï¸ **RTOS/ - FreeRTOSæ¨¡å—**

### **examples/Camera/RTOS_TaskManager.h/.cpp**
**åŠŸèƒ½**: FreeRTOSä»»åŠ¡ç®¡ç†å™¨
**æ ¸å¿ƒèŒè´£**:
1. ä»»åŠ¡åˆ›å»ºå’Œåˆ é™¤
2. ä»»åŠ¡çŠ¶æ€ç›‘æ§
3. ä»»åŠ¡ä¼˜å…ˆçº§ç®¡ç†
4. ç³»ç»Ÿèµ„æºç›‘æ§

**ä¸»è¦æ¥å£**:
```cpp
class TaskManager {
public:
    typedef enum {
        TASK_CAMERA_PREVIEW = 0,
        TASK_FUNCTION_B = 1,
        TASK_FUNCTION_C = 2,
        TASK_FUNCTION_D = 3,
        TASK_FUNCTION_E = 4,
        TASK_SYSTEM_SETTINGS = 5,
        TASK_MAX
    } TaskID;
    
    typedef struct {
        TaskID id;
        const char* name;
        TaskFunction_t function;
        uint32_t stackSize;
        UBaseType_t priority;
        TaskHandle_t handle;
        TaskState_t state;
    } TaskInfo;
    
    // åˆå§‹åŒ–
    static bool init();
    
    // ä»»åŠ¡ç®¡ç†
    static TaskHandle_t createTask(TaskID id);
    static bool deleteTask(TaskID id);
    static bool suspendTask(TaskID id);
    static bool resumeTask(TaskID id);
    
    // ä»»åŠ¡çŠ¶æ€
    static TaskState_t getTaskState(TaskID id);
    static const TaskInfo* getTaskInfo(TaskID id);
    static void listAllTasks(char* buffer, uint32_t bufferSize);
    
    // ç³»ç»Ÿç›‘æ§
    static uint32_t getFreeHeapSize();
    static uint32_t getMinimumEverFreeHeapSize();
    static uint8_t getCPUUsage();
    
    // äº‹ä»¶ç»„ç®¡ç†
    static EventGroupHandle_t getEventGroup();
    
    // æ¸…ç†
    static void cleanup();
};
```

### **examples/Camera/RTOS_TaskFactory.h/.cpp**
**åŠŸèƒ½**: ä»»åŠ¡åˆ›å»ºå·¥å‚
**æ ¸å¿ƒèŒè´£**:
1. ä»»åŠ¡å‡½æ•°æ³¨å†Œ
2. ä»»åŠ¡å‚æ•°ä¼ é€’
3. ä»»åŠ¡èµ„æºåˆ†é…
4. ä»»åŠ¡é”€æ¯æ¸…ç†

**ä¸»è¦æ¥å£**:
```cpp
class TaskFactory {
public:
    // ä»»åŠ¡å‡½æ•°åŸå‹
    typedef void (*TaskFunction)(void*);
    
    // ä»»åŠ¡é…ç½®
    struct TaskConfig {
        TaskFunction function;
        const char* name;
        uint32_t stackSize;
        UBaseType_t priority;
        void* parameters;
    };
    
    // æ³¨å†Œä»»åŠ¡å‡½æ•°
    static bool registerTask(TaskManager::TaskID id, const TaskConfig& config);
    
    // åˆ›å»ºä»»åŠ¡å®ä¾‹
    static TaskHandle_t createTaskInstance(TaskManager::TaskID id);
    
    // è·å–é»˜è®¤é…ç½®
    static TaskConfig getDefaultConfig(TaskManager::TaskID id);
    
    // ä»»åŠ¡å‚æ•°ç®¡ç†
    static void* createTaskParameters(TaskManager::TaskID id, void* userData);
    static void destroyTaskParameters(void* parameters);
    
    // æ¸…ç†
    static void cleanup();
};
```

### **examples/Camera/RTOS_EventDispatcher.h/.cpp**
**åŠŸèƒ½**: äº‹ä»¶åˆ†å‘ç³»ç»Ÿ
**æ ¸å¿ƒèŒè´£**:
1. äº‹ä»¶æ³¨å†Œå’Œè®¢é˜…
2. äº‹ä»¶åˆ†å‘å¤„ç†
3. äº‹ä»¶é˜Ÿåˆ—ç®¡ç†
4. äº‹ä»¶ä¼˜å…ˆçº§æ§åˆ¶

**ä¸»è¦æ¥å£**:
```cpp
class EventDispatcher {
public:
    typedef enum {
        EVENT_ENCODER_ROTATION = 0x01,
        EVENT_BUTTON_PRESS = 0x02,
        EVENT_CAPTURE_REQUEST = 0x04,
        EVENT_TASK_START = 0x08,
        EVENT_TASK_STOP = 0x10,
        EVENT_SYSTEM_ERROR = 0x20,
        EVENT_ALL = 0xFF
    } EventType;
    
    typedef struct {
        EventType type;
        uint32_t timestamp;
        void* data;
        uint32_t dataSize;
    } Event;
    
    typedef void (*EventHandler)(const Event*);
    
    // åˆå§‹åŒ–
    static bool init(uint32_t queueSize);
    
    // äº‹ä»¶å‘å¸ƒ
    static bool postEvent(EventType type, void* data = nullptr, uint32_t dataSize = 0);
    
    // äº‹ä»¶è®¢é˜…
    static bool subscribe(EventType type, EventHandler handler);
    static bool unsubscribe(EventType type, EventHandler handler);
    
    // äº‹ä»¶å¤„ç†
    static void processEvents();
    static uint32_t getPendingEventCount();
    
    // æ¸…ç†
    static void cleanup();
};
```

### **examples/Camera/RTOS_SemaphoreManager.h/.cpp**
**åŠŸèƒ½**: ä¿¡å·é‡å’Œäº’æ–¥é”ç®¡ç†
**æ ¸å¿ƒèŒè´£**:
1. ä¿¡å·é‡åˆ›å»ºå’Œé”€æ¯
2. äº’æ–¥é”ç®¡ç†
3. æ­»é”æ£€æµ‹
4. èµ„æºåŒæ­¥

**ä¸»è¦æ¥å£**:
```cpp
class SemaphoreManager {
public:
    typedef enum {
        MUTEX_GLOBAL = 0,
        MUTEX_CAMERA = 1,
        MUTEX_DISPLAY = 2,
        MUTEX_SDCARD = 3,
        MUTEX_MAX
    } MutexID;
    
    typedef enum {
        SEMAPHORE_CAPTURE = 0,
        SEMAPHORE_PREVIEW = 1,
        SEMAPHORE_MAX
    } SemaphoreID;
    
    // åˆå§‹åŒ–
    static bool init();
    
    // äº’æ–¥é”æ“ä½œ
    static SemaphoreHandle_t getMutex(MutexID id);
    static bool lock(MutexID id, TickType_t timeout = portMAX_DELAY);
    static bool unlock(MutexID id);
    
    // ä¿¡å·é‡æ“ä½œ
    static SemaphoreHandle_t getSemaphore(SemaphoreID id);
    static bool take(SemaphoreID id, TickType_t timeout = portMAX_DELAY);
    static bool give(SemaphoreID id);
    static bool giveFromISR(SemaphoreID id);
    
    // æ­»é”æ£€æµ‹
    static bool checkForDeadlocks();
    
    // èµ„æºçŠ¶æ€
    static void printMutexStatus(char* buffer, uint32_t bufferSize);
    
    // æ¸…ç†
    static void cleanup();
};
```

---

## ğŸ—ï¸ **System/ - ç³»ç»Ÿæ¨¡å—**

### **examples/Camera/System_StateManager.h/.cpp**
**åŠŸèƒ½**: ç³»ç»ŸçŠ¶æ€æœºç®¡ç†
**æ ¸å¿ƒèŒè´£**:
1. çŠ¶æ€åˆ‡æ¢æ§åˆ¶
2. çŠ¶æ€æŒä¹…åŒ–
3. çŠ¶æ€éªŒè¯
4. çŠ¶æ€äº‹ä»¶é€šçŸ¥

**ä¸»è¦æ¥å£**:
```cpp
class StateManager {
public:
    typedef enum {
        STATE_BOOT = 0,
        STATE_MAIN_MENU = 1,
        STATE_CAMERA_PREVIEW = 2,
        STATE_PHOTO_CAPTURE = 3,
        STATE_SETTINGS_MENU = 4,
        STATE_SHUTDOWN = 5,
        STATE_ERROR = 6
    } SystemState;
    
    typedef struct {
        SystemState currentState;
        SystemState previousState;
        uint32_t stateEnterTime;
        uint32_t stateDuration;
        uint8_t errorCode;
    } StateInfo;
    
    // åˆå§‹åŒ–
    static bool init();
    
    // çŠ¶æ€åˆ‡æ¢
    static bool setState(SystemState newState);
    static bool requestStateChange(SystemState newState);
    
    // çŠ¶æ€æŸ¥è¯¢
    static SystemState getCurrentState();
    static SystemState getPreviousState();
    static const StateInfo* getStateInfo();
    
    // çŠ¶æ€éªŒè¯
    static bool isStateValid(SystemState state);
    static bool canTransitionTo(SystemState newState);
    
    // çŠ¶æ€æŒä¹…åŒ–
    static bool saveStateToFlash();
    static bool loadStateFromFlash();
    
    // æ¸…ç†
    static void cleanup();
};
```

### **examples/Camera/System_ResourceManager.h/.cpp**
**åŠŸèƒ½**: å…¨å±€èµ„æºç®¡ç†å™¨
**æ ¸å¿ƒèŒè´£**:
1. èµ„æºåˆ†é…å’Œé‡Šæ”¾
2. å†…å­˜æ± ç®¡ç†
3. èµ„æºä½¿ç”¨ç»Ÿè®¡
4. æ³„æ¼æ£€æµ‹

**ä¸»è¦æ¥å£**:
```cpp
class ResourceManager {
public:
    typedef enum {
        RESOURCE_IMAGE_BUFFER = 0,
        RESOURCE_JPEG_BUFFER = 1,
        RESOURCE_FONT_BUFFER = 2,
        RESOURCE_TASK_STACK = 3,
        RESOURCE_FILE_BUFFER = 4,
        RESOURCE_MAX
    } ResourceType;
    
    typedef struct {
        uint32_t totalAllocated;
        uint32_t currentlyUsed;
        uint32_t peakUsage;
        uint32_t allocationCount;
        uint32_t freeCount;
    } ResourceStats;
    
    // åˆå§‹åŒ–
    static bool init();
    
    // å†…å­˜åˆ†é…
    static void* allocate(ResourceType type, uint32_t size);
    static void* allocateAligned(ResourceType type, uint32_t size, uint32_t alignment);
    
    // å†…å­˜é‡Šæ”¾
    static bool free(ResourceType type, void* ptr);
    
    // å†…å­˜æ± ç®¡ç†
    static bool createPool(ResourceType type, uint32_t blockSize, uint32_t blockCount);
    static void* allocateFromPool(ResourceType type);
    static bool freeToPool(ResourceType type, void* ptr);
    
    // ç»Ÿè®¡ä¿¡æ¯
    static const ResourceStats* getStats(ResourceType type);
    static void printAllStats(char* buffer, uint32_t bufferSize);
    
    // æ³„æ¼æ£€æµ‹
    static bool checkForLeaks();
    
    // æ¸…ç†
    static void cleanup();
};
```

### **System_ConfigManager.h/.cpp**
**åŠŸèƒ½**: é…ç½®ç®¡ç†ç³»ç»Ÿ
**æ ¸å¿ƒèŒè´£**:
1. é…ç½®é¡¹ç®¡ç†
2. é…ç½®æŒä¹…åŒ–
3. é…ç½®éªŒè¯
4. é…ç½®ç‰ˆæœ¬æ§åˆ¶

**ä¸»è¦æ¥å£**:
```cpp
class ConfigManager {
public:
    typedef enum {
        CONFIG_CAMERA_RESOLUTION = 0,
        CONFIG_CAMERA_QUALITY = 1,
        CONFIG_DISPLAY_BRIGHTNESS = 2,
        CONFIG_ENCODER_SENSITIVITY = 3,
        CONFIG_SYSTEM_TIMEOUT = 4,
        CONFIG_MAX
    } ConfigID;
    
    typedef struct {
        uint32_t version;
        uint32_t checksum;
        uint32_t lastModified;
        uint8_t data[256];  // é…ç½®æ•°æ®
    } ConfigData;
    
    // åˆå§‹åŒ–
    static bool init();
    
    // é…ç½®è¯»å†™
    static bool setValue(ConfigID id, int32_t value);
    static int32_t getValue(ConfigID id);
    static bool setString(ConfigID id, const char* value);
    static const char* getString(ConfigID id, char* buffer, uint32_t size);
    
    // é…ç½®æŒä¹…åŒ–
    static bool saveToFlash();
    static bool loadFromFlash();
    static bool restoreDefaults();
    
    // é…ç½®éªŒè¯
    static bool validateConfig();
    static uint32_t calculateChecksum();
    
    // é…ç½®ä¿¡æ¯
    static uint32_t getConfigVersion();
    static uint32_t getLastModified();
    
    // æ¸…ç†
    static void cleanup();
};
```

---

## ğŸ› ï¸ **Utils/ - å·¥å…·æ¨¡å—**

**æ–‡ä»¶ä½ç½®**: `examples/Camera/Utils_*.h/.cpp`

### **Utils_Logger.h/.cpp**
**åŠŸèƒ½**: åˆ†çº§æ—¥å¿—ç³»ç»Ÿ
**æ ¸å¿ƒèŒè´£**:
1. å¤šçº§åˆ«æ—¥å¿—è¾“å‡º
2. æ—¥å¿—æ ¼å¼åŒ–
3. æ—¥å¿—è¿‡æ»¤
4. æ—¥å¿—å­˜å‚¨

**ä¸»è¦æ¥å£**:
```cpp
class Logger {
public:
    typedef enum {
        LEVEL_ERROR = 0,
        LEVEL_WARN = 1,
        LEVEL_INFO = 2,
        LEVEL_DEBUG = 3,
        LEVEL_VERBOSE = 4
    } LogLevel;
    
    typedef enum {
        TARGET_SERIAL = 0x01,
        TARGET_SDCARD = 0x02,
        TARGET_DISPLAY = 0x04
    } LogTarget;
    
    // åˆå§‹åŒ–
    static bool init(uint32_t baudRate = 115200);
    
    // æ—¥å¿—è¾“å‡º
    static void error(const char* tag, const char* format, ...);
    static void warn(const char* tag, const char* format, ...);
    static void info(const char* tag, const char* format, ...);
    static void debug(const char* tag, const char* format, ...);
    static void verbose(const char* tag, const char* format, ...);
    
    // æ—¥å¿—æ§åˆ¶
    static void setLevel(LogLevel level);
    static void setTarget(uint8_t target);
    static void enableTag(const char* tag);
    static void disableTag(const char* tag);
    
    // æ—¥å¿—æ–‡ä»¶ç®¡ç†
    static bool createLogFile();
    static bool rotateLogFile();
    static uint32_t getLogFileSize();
    
    // æ¸…ç†
    static void cleanup();
};
```

### **Utils_Timer.h/.cpp**
**åŠŸèƒ½**: é«˜ç²¾åº¦å®šæ—¶å™¨å·¥å…·
**æ ¸å¿ƒèŒè´£**:
1. å»¶æ—¶å‡½æ•°
2. è¶…æ—¶æ£€æµ‹
3. å®šæ—¶ä»»åŠ¡è°ƒåº¦
4. æ€§èƒ½æµ‹é‡

**ä¸»è¦æ¥å£**:
```cpp
class Timer {
public:
    // å»¶æ—¶å‡½æ•°
    static void delayMs(uint32_t ms);
    static void delayUs(uint32_t us);
    
    // æ—¶é—´è·å–
    static uint32_t millis();
    static uint32_t micros();
    static uint64_t millis64();
    
    // è¶…æ—¶æ£€æµ‹
    class Timeout {
    public:
        Timeout(uint32_t timeoutMs);
        bool expired() const;
        uint32_t remaining() const;
        void reset();
        
    private:
        uint32_t startTime;
        uint32_t timeout;
    };
    
    // å®šæ—¶ä»»åŠ¡
    typedef void (*TimerCallback)(void*);
    
    static bool schedule(TimerCallback callback, void* data, 
                        uint32_t intervalMs, bool repeat = false);
    static bool cancel(TimerCallback callback);
    
    // æ€§èƒ½æµ‹é‡
    class Stopwatch {
    public:
        void start();
        void stop();
        uint32_t elapsedMs() const;
        uint32_t elapsedUs() const;
        
    private:
        uint32_t startTime;
        uint32_t endTime;
        bool running;
    };
    
    // æ¸…ç†
    static void cleanup();
};
```

### **Utils_BufferManager.h/.cpp**
**åŠŸèƒ½**: ç¼“å†²åŒºæ± ç®¡ç†
**æ ¸å¿ƒèŒè´£**:
1. ç¼“å†²åŒºåˆ†é…å’Œå›æ”¶
2. ç¼“å†²åŒºæ± ä¼˜åŒ–
3. ç¼“å†²åŒºç»Ÿè®¡
4. å†…å­˜å¯¹é½å¤„ç†

**ä¸»è¦æ¥å£**:
```cpp
class BufferManager {
public:
    typedef enum {
        BUFFER_TYPE_SMALL = 0,    // < 1KB
        BUFFER_TYPE_MEDIUM = 1,   // 1KB - 16KB
        BUFFER_TYPE_LARGE = 2,    // 16KB - 64KB
        BUFFER_TYPE_HUGE = 3,     // > 64KB
        BUFFER_TYPE_MAX
    } BufferType;
    
    typedef struct {
        uint8_t* data;
        uint32_t size;
        BufferType type;
        uint32_t timestamp;
        bool inUse;
    } BufferInfo;
    
    // åˆå§‹åŒ–
    static bool init();
    
    // ç¼“å†²åŒºåˆ†é…
    static uint8_t* allocate(uint32_t size, uint32_t alignment = 1);
    static uint8_t* allocateAligned(uint32_t size, uint32_t alignment);
    
    // ç¼“å†²åŒºé‡Šæ”¾
    static bool free(uint8_t* buffer);
    
    // æ± åŒ–ç®¡ç†
    static bool createPool(BufferType type, uint32_t bufferSize, uint32_t bufferCount);
    static uint8_t* allocateFromPool(BufferType type);
    static bool freeToPool(BufferType type, uint8_t* buffer);
    
    // ç»Ÿè®¡ä¿¡æ¯
    static uint32_t getTotalAllocated();
    static uint32_t getCurrentlyUsed();
    static uint32_t getPeakUsage();
    
    // è°ƒè¯•åŠŸèƒ½
    static void dumpBufferInfo(char* buffer, uint32_t bufferSize);
    static bool checkBufferIntegrity();
    
    // æ¸…ç†
    static void cleanup();
};
```

---

## ğŸ”— **Shared/ - å…±äº«æ¨¡å—**

### **GlobalDefines.h**
**åŠŸèƒ½**: å…¨å±€å¸¸é‡ã€æšä¸¾ã€å®å®šä¹‰
**åŒ…å«**:

```cpp
// å¼•è„šå®šä¹‰
#define TFT_CS    SPI1_SS
#define TFT_DC    4
#define TFT_RST   5
#define TFT_BL    6

#define ENCODER_CLK  7
#define ENCODER_DT   8
#define ENCODER_SW   9

// ç›¸æœºé€šé“å®šä¹‰
#define PREVIEW_CH    0
#define STILL_CH      1

// é¢œè‰²å®šä¹‰ (RGB565)
#define ST7789_BLACK   0x0000
#define ST7789_WHITE   0xFFFF
#define ST7789_RED     0xF800
#define ST7789_GREEN   0x07E0
#define ST7789_BLUE    0x001F
#define ST7789_YELLOW  0xFFE0
#define ST7789_CYAN    0x07FF
#define ST7789_MAGENTA 0xF81F

// å­—ä½“ç›¸å…³å¸¸é‡
#define FONT_WIDTH     16
#define FONT_HEIGHT    16
#define FONT_CHAR_SIZE 32  // 16x16ç‚¹é˜µï¼Œæ¯ä¸ªå­—ç¬¦32å­—èŠ‚

// èœå•ç›¸å…³å¸¸é‡
#define MENU_ITEMS_COUNT   6
#define TRIANGLE_SIZE      7
#define TRIANGLE_X_OFFSET  40

// æ—¶é—´å¸¸é‡
#define BUTTON_DEBOUNCE_DELAY   50
#define ENCODER_DEBOUNCE_DELAY  300
#define CAPTURE_DELAY_MS        200

// æ–‡ä»¶è·¯å¾„
#define SD_ROOT_PATH        "0:/"
#define PHOTO_DIRECTORY     "0:/photos/"
#define LOG_DIRECTORY       "0:/logs/"
#define CONFIG_FILE         "0:/config.bin"

// ç³»ç»Ÿç‰ˆæœ¬
#define FIRMWARE_VERSION    "1.0.0"
#define HARDWARE_VERSION    "AMB82-MINI"
#define BUILD_DATE          __DATE__
#define BUILD_TIME          __TIME__

// å…¶ä»–å®
#define ARRAY_SIZE(arr)     (sizeof(arr) / sizeof((arr)[0]))
#define MIN(a, b)           (((a) < (b)) ? (a) : (b))
#define MAX(a, b)           (((a) > (b)) ? (a) : (b))
#define CLAMP(x, min, max)  (((x) < (min)) ? (min) : (((x) > (max)) ? (max) : (x)))
```

### **SharedResources.h**
**åŠŸèƒ½**: å…¨å±€å…±äº«èµ„æºå£°æ˜
**åŒ…å«**:

```cpp
// å¤–éƒ¨å£°æ˜çš„å…¨å±€å¯¹è±¡ï¼ˆåœ¨å„è‡ªçš„æ¨¡å—ä¸­å®šä¹‰ï¼‰
#ifdef __cplusplus
extern "C" {
#endif

// ç³»ç»ŸçŠ¶æ€
extern volatile bool g_systemRunning;
extern volatile bool g_cameraActive;
extern volatile bool g_captureInProgress;
extern volatile int g_encoderCount;

// äº’æ–¥é”å¥æŸ„
extern SemaphoreHandle_t g_displayMutex;
extern SemaphoreHandle_t g_cameraMutex;
extern SemaphoreHandle_t g_sdCardMutex;

// äº‹ä»¶ç»„å¥æŸ„
extern EventGroupHandle_t g_systemEvents;

// ä»»åŠ¡å¥æŸ„
extern TaskHandle_t g_mainTaskHandle;
extern TaskHandle_t g_displayTaskHandle;
extern TaskHandle_t g_cameraTaskHandle;

// æ¶ˆæ¯é˜Ÿåˆ—
extern QueueHandle_t g_eventQueue;
extern QueueHandle_t g_commandQueue;

// ç¼“å†²åŒºæŒ‡é’ˆ
extern uint8_t* g_frameBuffer;
extern uint8_t* g_jpegBuffer;
extern uint8_t* g_fontBuffer;

// é…ç½®æ•°æ®
extern uint32_t g_systemConfig;
extern uint16_t g_displayBrightness;
extern uint8_t g_cameraQuality;

#ifdef __cplusplus
}
#endif
```

### **Types.h**
**åŠŸèƒ½**: å…¬å…±ç±»å‹å®šä¹‰
**åŒ…å«**:

```cpp
// åŸºç¡€ç±»å‹é‡å®šä¹‰
typedef uint8_t     u8;
typedef uint16_t    u16;
typedef uint32_t    u32;
typedef uint64_t    u64;
typedef int8_t      i8;
typedef int16_t     i16;
typedef int32_t     i32;
typedef int64_t     i64;
typedef float       f32;
typedef double      f64;

// é€šç”¨ç»“æ„ä½“
typedef struct {
    u16 x;
    u16 y;
} Point;

typedef struct {
    u16 width;
    u16 height;
} Size;

typedef struct {
    u16 left;
    u16 top;
    u16 right;
    u16 bottom;
} Rect;

typedef struct {
    u8 r;
    u8 g;
    u8 b;
} RGBColor;

typedef struct {
    u16 raw;  // RGB565æ ¼å¼
} Color16;

// ç›¸æœºç›¸å…³ç±»å‹
typedef struct {
    u32 addr;
    u32 size;
    u32 timestamp;
    u16 width;
    u16 height;
    u8 quality;
} ImageData;

typedef struct {
    u8 channel;
    u32 resolution;
    u32 fps;
    u32 format;
    bool active;
} CameraChannel;

// èœå•ç›¸å…³ç±»å‹
typedef struct {
    u8 position;      // 0-5å¯¹åº”A-F
    u16 x;
    u16 y;
    bool visible;
} MenuItem;

typedef struct {
    u8 id;
    const char* name;
    MenuItem items[MENU_ITEMS_COUNT];
    u8 selectedItem;
} MenuPage;

// äº‹ä»¶ç±»å‹
typedef struct {
    u32 type;
    u32 timestamp;
    union {
        struct {
            i8 direction;  // æ—‹è½¬æ–¹å‘
            u32 count;     // ç¼–ç å™¨è®¡æ•°
        } encoder;
        struct {
            bool pressed;
            u32 duration;
        } button;
        struct {
            u32 taskId;
            u32 command;
            void* data;
        } task;
        struct {
            u32 errorCode;
            const char* message;
        } error;
    } data;
} EventData;

// ä»»åŠ¡æ¶ˆæ¯
typedef struct {
    u32 taskId;
    u32 command;
    void* data;
    u32 dataSize;
} TaskMessage;

// ç³»ç»Ÿé…ç½®
typedef struct {
    u32 version;
    u32 checksum;
    struct {
        u8 displayBrightness;
        u8 cameraQuality;
        u8 encoderSensitivity;
        u16 systemTimeout;
        bool savePhotos;
        bool showPreview;
    } settings;
    u8 reserved[64];
} SystemConfig;

// å‡½æ•°æŒ‡é’ˆç±»å‹
typedef void (*TaskFunction)(void*);
typedef void (*EventHandler)(const EventData*);
typedef void (*DrawCallback)(u16 x, u16 y, u16 w, u16 h, const u16* data);
typedef int (*JPEGDecodeCallback)(JPEGDRAW* draw);

// æšä¸¾ç±»å‹
enum SystemMode {
    MODE_MENU = 0,
    MODE_PREVIEW = 1,
    MODE_CAPTURE = 2,
    MODE_SETTINGS = 3,
    MODE_ERROR = 4
};

enum ButtonAction {
    ACTION_NONE = 0,
    ACTION_SHORT_PRESS = 1,
    ACTION_LONG_PRESS = 2,
    ACTION_DOUBLE_PRESS = 3
};

enum ErrorCode {
    ERROR_NONE = 0,
    ERROR_SD_CARD = 1,
    ERROR_CAMERA = 2,
    ERROR_MEMORY = 3,
    ERROR_DISPLAY = 4,
    ERROR_SYSTEM = 5
};
```

è¿™æ ·çš„æ¨¡å—åŒ–è®¾è®¡æä¾›äº†æ¸…æ™°çš„èŒè´£åˆ’åˆ†å’Œè‰¯å¥½çš„ä»£ç ç»„ç»‡ï¼ŒåŒæ—¶é€šè¿‡ç²¾ç»†çš„æ¥å£è®¾è®¡ç¡®ä¿äº†æ¨¡å—é—´çš„ä½è€¦åˆæ€§ã€‚